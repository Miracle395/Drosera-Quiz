<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Union Quiz â€” 20 Questions</title>
<style>
  :root{
    --sky: #7ec8ff;
    --black: #0b0b0b;
    --white: #ffffff;
    --card-width: 360px;
  }
  html,body{ height:100%; margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--sky); -webkit-tap-highlight-color: transparent; }
  .wrap{ min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px; box-sizing:border-box; }

  /* Main container slightly smaller to show blue edges */
  #container{
    width:100%;
    max-width:var(--card-width);
    background:var(--black);
    color:var(--white);
    border-radius:10px;
    padding:16px;
    box-sizing:border-box;
    border:4px solid var(--sky);
    position:relative;
    overflow:hidden;
  }

  header.title{ text-align:center; margin-bottom:6px; }
  header.title h1{ font-size:1.05rem; margin:6px 0 0 0; letter-spacing:0.5px; }
  header.title p{ margin:6px 0 0 0; opacity:0.85; font-size:0.9rem; }

  .screen{ display:none; }
  .active{ display:block; }

  /* Username screen */
  .usernameBox{ display:flex; flex-direction:column; gap:10px; align-items:stretch; }
  #usernameInput{
    width:100%;
    min-height:52px; /* fit inside black box */
    padding:12px;
    box-sizing:border-box;
    border-radius:8px;
    border:2px solid rgba(255,255,255,0.08);
    background:rgba(255,255,255,0.02);
    color:var(--white);
    font-size:1rem;
    outline:none;
  }
  #usernameInput::placeholder{ color: rgba(255,255,255,0.5); }

  .muted { color: rgba(255,255,255,0.8); font-size:0.95rem; }

  /* Buttons */
  .btn {
    display:inline-block;
    padding:10px 12px;
    border-radius:8px;
    border:none;
    cursor:pointer;
    font-weight:600;
    font-size:0.98rem;
  }
  #startBtn{ background:var(--sky); color:var(--black); width:100%; padding:10px; font-size:1.05rem; } /* slightly reduced */
  .nextBtn{
    margin-top:2.25rem; /* two-line spacing under options */
    background:var(--white);
    color:var(--black);
    width:100%;
    padding:10px;
    border-radius:8px;
    border:none;
    font-weight:700;
    cursor:pointer;
  }

  /* Profile row, timer, score */
  .topRow{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:8px; }
  .player{ display:flex; align-items:center; gap:10px; }
  .player img{ width:44px; height:44px; border-radius:50%; object-fit:cover; border:2px solid var(--sky); background:#222; }
  .player .user{ font-weight:700; font-size:0.95rem; }
  .meta{ text-align:right; font-size:0.95rem; }
  #timer{ font-weight:800; font-size:1rem; letter-spacing:0.8px; }
  #scoreBox{ display:inline-block; padding:6px 10px; border-radius:8px; border:2px solid var(--sky); background:rgba(255,255,255,0.02); font-weight:700; }

  /* Question card */
  .qCard{ background:var(--black); padding:8px 0 0 0; }
  #qCounter{ margin-bottom:6px; opacity:0.9; font-size:0.95rem; }
  #question{ font-size:1.05rem; margin:8px 0 12px 0; line-height:1.3; color:var(--white); }

  .options{ display:flex; flex-direction:column; gap:8px; }
  .optionBtn{
    text-align:left;
    padding:12px;
    border-radius:8px;
    background:var(--sky);
    color:var(--black);
    border:0;
    cursor:pointer;
    font-weight:700;
    box-shadow: none;
    width:100%;
  }
  .optionBtn:hover{ filter:brightness(0.95); }
  .optionBtn.selected{ outline:3px solid rgba(255,255,255,0.08); transform:translateY(-1px); }
  .optionBtn.correct{ background: #c8ffd1; color:#003300; }
  .optionBtn.wrong{ background: #ffd1d1; color:#330000; }

  /* Result placard (reduced width box with blue edges) */
  #resultPlacard{
    width:240px;
    margin:18px auto 0 auto;
    padding:12px;
    border-radius:10px;
    border:4px solid var(--sky);
    background:var(--black);
    text-align:center;
  }
  #resultPlacard img{ width:72px; height:72px; border-radius:50%; border:3px solid var(--sky); object-fit:cover; }
  #resultPlacard h2{ margin:8px 0 4px 0; font-size:1.05rem; }
  #resultPlacard p{ margin:6px 0; font-weight:700; font-size:1rem; }

  .overlay{
    position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.55); z-index:60; color:var(--white);
  }
  .overlay .box{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:18px; border:3px solid var(--sky); text-align:center; width:85%; max-width:320px;}
  .overlay h3{ margin:6px 0; }
  .closeOverlay{ margin-top:12px; padding:10px 12px; border-radius:8px; border:none; background:var(--sky); color:var(--black); font-weight:700; cursor:pointer; }

  .confetti-piece, .sad-piece{ position:fixed; width:12px; height:12px; z-index:70; pointer-events:none; opacity:0.95; transform:translateY(-100vh); }
  @keyframes fall {
    0% { transform: translateY(-10vh) rotate(0deg); }
    100% { transform: translateY(120vh) rotate(720deg); opacity:1; }
  }
  @keyframes fall-sad {
    0% { transform: translateY(-10vh) rotate(0deg) scale(0.8); }
    100% { transform: translateY(120vh) rotate(90deg) scale(1.1); opacity:1; }
  }

  .small { font-size:0.9rem; opacity:0.95; }
  @media (max-width:420px){
    :root{ --card-width:340px; }
    #usernameInput{ min-height:60px; font-size:1.05rem; }
    .player img{ width:44px; height:44px; }
    .optionBtn{ font-size:1rem; padding:12px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <div id="container" role="application" aria-live="polite">
      <header class="title">
        <h1>Union Quiz</h1>
        <p class="muted">20 questions, 4 options, 10 minutes. Goodluck!</p>
      </header>

      <!-- USERNAME SCREEN -->
      <section id="usernameScreen" class="screen active" aria-hidden="false">
        <div class="usernameBox">
          <label for="usernameInput" class="small">Enter your X username</label>
          <input id="usernameInput" type="text" placeholder="Input your X username here" aria-label="Input your X username here" />
          <button id="startBtn" class="btn" aria-label="Start quiz">Start</button>
          <p class="muted small">Tip: Don't include the @. Example: elonmusk</p>
        </div>
      </section>

      <!-- QUIZ SCREEN -->
      <section id="quizScreen" class="screen" aria-hidden="true">
        <div class="topRow">
          <div class="player">
            <img id="avatar" src="" alt="player avatar" />
            <div>
              <div id="displayUser" class="user">player</div>
              <div class="small muted" id="gameInfo">Play smart â€” good luck!</div>
            </div>
          </div>
          <div class="meta">
            <div id="timer" aria-live="polite">10:00</div>
            <div id="scoreBox">Score: <span id="score">0</span></div>
          </div>
        </div>

        <div class="qCard">
          <div id="qCounter">Question 1 of 20</div>
          <div id="question">...</div>

          <div class="options" id="options"></div>

          <button id="nextBtn" class="nextBtn">NEXT</button>
        </div>
      </section>

      <!-- RESULT SCREEN -->
      <section id="resultScreen" class="screen" aria-hidden="true">
        <div id="resultPlacard" role="region" aria-label="Result placard">
          <img id="finalAvatar" src="" alt="final avatar" />
          <h2 id="finalUser">username</h2>
          <p id="finalScore">Score: 0/20</p>
          <div style="display:flex; gap:8px; justify-content:center; margin-top:8px;">
            <button id="retryBtn" class="btn" style="background:var(--sky); color:var(--black)">Play Again</button>
            <button id="shareBtn" class="btn" style="background:transparent; color:var(--white); border:2px solid var(--sky)">Share on X</button>
          </div>
        </div>
      </section>
    </div>
  </div>

<script>
/* 20 Union tech-focused questions (kept from earlier list), randomized */
const QUESTIONS = [
  { q: "What protocol does Union use to communicate between blockchains?", answer: "IBC", distractors: ["HTTP","REST","FTP"] },
  { q: "What cryptography helps Union produce proofs without revealing private data?", answer: "Zeroâ€‘Knowledge Proofs", distractors: ["RSA","AES","Hash functions"] },
  { q: "What signature scheme is commonly used in Union for aggregation?", answer: "BLS Signatures", distractors: ["ECDSA","RSA","Schnorr"] },
  { q: "What is the Union node binary typically called?", answer: "uniond", distractors: ["union-node","nodeUnion","union-core"] },
  { q: "Which component relays messages across ecosystems in Union?", answer: "Voyager", distractors: ["Hubble","Galois","LightClient"] },
  { q: "Which component indexes messages for efficient querying?", answer: "Hubble", distractors: ["Voyager","LightClient","uniond"] },
  { q: "What component is responsible for generating ZK proofs in Union?", answer: "Galois", distractors: ["Voyager","uniond","CometBLS"] },
  { q: "Which tool supervises node operations in production?", answer: "Unionvisor", distractors: ["Hubble","Voyager","Galois"] },
  { q: "What term describes verifying consensus correctness without trusting nodes?", answer: "Consensus Verification", distractors: ["Oracles","MPC","Multisig"] },
  { q: "Union supports NFTs and which DeFi area?", answer: "DeFi", distractors: ["CEX","Staking Only","Yield Farming Only"] },
  { q: "Which clients avoid downloading the full chain state?", answer: "Light Clients", distractors: ["Full Nodes","Wallets","Relayers"] },
  { q: "Union extends IBC and enables which channel type in some designs?", answer: "Recursive", distractors: ["Simple","Direct","Centralized"] },
  { q: "Which standard is Union built around for cross-chain messaging?", answer: "IBC", distractors: ["HTTP","GraphQL","RPC"] },
  { q: "What powers modular, high-performance relaying in Union?", answer: "Voyager", distractors: ["Hubble","Router","Validator"] },
  { q: "Union avoids trusted third parties by using what?", answer: "Consensus Verification", distractors: ["Oracles","MPC","Multisig"] },
  { q: "What is the name of Union's prover tool?", answer: "Galois", distractors: ["Voyager","Hubble","uniond"] },
  { q: "Which SDK does Union offer for front-end integration?", answer: "TypeScript SDK", distractors: ["Python SDK","Java SDK","Go SDK"] },
  { q: "Union integrates with Cosmos chains via which protocol?", answer: "IBC", distractors: ["REST","RPC","GraphQL"] },
  { q: "Which governance model does Union use for upgrades?", answer: "Decentralized governance", distractors: ["Central control","CEO","DAO-only"] },
  { q: "ZK proofs in Union primarily help reduce what?", answer: "Latency", distractors: ["Cost","Risk","All of the above"] }
];

function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
function formatTime(seconds){ const m=Math.floor(seconds/60).toString().padStart(2,'0'); const s=(seconds%60).toString().padStart(2,'0'); return `${m}:${s}`; }

let state = { username:'', avatarUrl:'', questions:[], currentIndex:0, score:0, secondsLeft:600, timerInterval:null, selectedOptionIndex:null, ended:false };

const usernameInput = document.getElementById('usernameInput');
const startBtn = document.getElementById('startBtn');
const avatarImg = document.getElementById('avatar');
const displayUser = document.getElementById('displayUser');
const timerEl = document.getElementById('timer');
const scoreEl = document.getElementById('score');
const qCounterEl = document.getElementById('qCounter');
const questionEl = document.getElementById('question');
const optionsEl = document.getElementById('options');
const nextBtn = document.getElementById('nextBtn');

const finalAvatar = document.getElementById('finalAvatar');
const finalUser = document.getElementById('finalUser');
const finalScore = document.getElementById('finalScore');
const retryBtn = document.getElementById('retryBtn');
const shareBtn = document.getElementById('shareBtn');

// inline genderless SVG data URL
const GENDERLESS_SVG = 'data:image/svg+xml;utf8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><rect fill="%230b0b0b" width="200" height="200" rx="20"/><g transform="translate(36 28)"><circle cx="60" cy="44" r="34" fill="%237ec8ff" /><circle cx="60" cy="44" r="28" fill="%23ffffff" /><rect x="12" y="96" width="96" height="56" rx="10" fill="%23ffffff" /></g></svg>');

// helper to test image URL quickly
function testImage(url, cb){
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.onload = ()=> cb(true);
  img.onerror = ()=> cb(false);
  img.src = url + '?_=' + Date.now();
}

function tryLoadAvatar(username, onResult){
  if(!username){ onResult(null); return; }
  const u = encodeURIComponent(username);
  const urls = [
    `https://unavatar.io/twitter/${u}`,
    `https://unavatar.io/x/${u}`
  ];
  let i=0;
  function next(){
    if(i>=urls.length){ onResult(null); return; }
    testImage(urls[i], (ok)=>{ if(ok) onResult(urls[i]); else { i++; next(); } });
  }
  next();
}

startBtn.addEventListener('click', ()=>{
  const raw = usernameInput.value.trim();
  const username = raw.replace(/^@/,'') || 'guest';
  state.username = username;
  displayUser.textContent = username;
  // fetch avatar then start
  tryLoadAvatar(username, (url)=>{
    state.avatarUrl = url || GENDERLESS_SVG;
    avatarImg.src = state.avatarUrl;
    finalAvatar.src = state.avatarUrl;
    prepareQuestions();
    showScreen('quiz');
    startTimer();
    renderQuestion();
  });
});

function prepareQuestions(){
  const copy = JSON.parse(JSON.stringify(QUESTIONS));
  shuffle(copy);
  state.questions = copy.slice(0,20).map(q=>{
    const opts = [q.answer, ...q.distractors];
    shuffle(opts);
    return { q: q.q, options: opts, correct: q.answer };
  });
  state.currentIndex = 0;
  state.score = 0;
  state.secondsLeft = 600;
  state.ended = false;
  scoreEl.textContent = state.score;
  timerEl.textContent = formatTime(state.secondsLeft);
}

function startTimer(){
  clearInterval(state.timerInterval);
  timerEl.textContent = formatTime(state.secondsLeft);
  state.timerInterval = setInterval(()=>{
    state.secondsLeft--;
    timerEl.textContent = formatTime(Math.max(0,state.secondsLeft));
    if(state.secondsLeft<=0){ clearInterval(state.timerInterval); endGame(); }
  },1000);
}

function renderQuestion(){
  const idx = state.currentIndex;
  if(idx>=state.questions.length){ endGame(); return; }
  const item = state.questions[idx];
  qCounterEl.textContent = `Question ${idx+1} of ${state.questions.length}`;
  questionEl.textContent = item.q;
  optionsEl.innerHTML = '';
  state.selectedOptionIndex = null;
  item.options.forEach((opt,i)=>{
    const btn = document.createElement('button');
    btn.className = 'optionBtn';
    btn.type = 'button';
    btn.textContent = opt;
    btn.dataset.index = i;
    btn.addEventListener('click', ()=> onSelectOption(i, btn));
    optionsEl.appendChild(btn);
  });
}

function onSelectOption(i, btn){
  const all = optionsEl.querySelectorAll('.optionBtn');
  all.forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  state.selectedOptionIndex = i;
}

nextBtn.addEventListener('click', ()=>{
  if(state.selectedOptionIndex===null){ flashMessage('Please select an option before continuing'); return; }
  const cur = state.questions[state.currentIndex];
  const chosen = cur.options[state.selectedOptionIndex];
  const allBtns = optionsEl.querySelectorAll('.optionBtn');
  allBtns.forEach((b,idx)=>{
    if(b.textContent === cur.correct) b.classList.add('correct');
    else if(idx === state.selectedOptionIndex) b.classList.add('wrong');
    b.disabled = true;
  });
  if(chosen === cur.correct){ state.score++; scoreEl.textContent = state.score; }
  setTimeout(()=>{
    state.currentIndex++;
    if(state.currentIndex>=state.questions.length) endGame(); else renderQuestion();
  },700);
});

function flashMessage(text){
  const el = document.createElement('div');
  el.className = 'overlay';
  el.style.background = 'transparent';
  el.style.position = 'absolute';
  el.style.top = '12px';
  el.style.left = '50%';
  el.style.transform = 'translateX(-50%)';
  el.style.zIndex = 80;
  el.innerHTML = `<div style="background:#000000cc;border:2px solid var(--sky);padding:8px 12px;border-radius:8px;color:white">${text}</div>`;
  document.getElementById('container').appendChild(el);
  setTimeout(()=> el.remove(),1400);
}

function endGame(){
  if(state.ended) return;
  state.ended = true;
  clearInterval(state.timerInterval);
  finalUser.textContent = state.username;
  finalScore.textContent = `Score: ${state.score} / ${state.questions.length}`;
  finalAvatar.src = state.avatarUrl || GENDERLESS_SVG;
  showScreen('result');
  if(state.score>=10){ showOverlay(true); launchConfetti(60); } else { showOverlay(false); launchSad(24); }
}

function showOverlay(win){
  const ov = document.createElement('div');
  ov.className = 'overlay';
  const title = win ? 'You did it!' : 'Good attempt';
  const text = win ? `Nice work â€” you scored ${state.score}/${state.questions.length}` : `You scored ${state.score}/${state.questions.length}. Try again!`;
  ov.innerHTML = `<div class="box"><h3>${title}</h3><p>${text}</p><button class="closeOverlay">Close</button></div>`;
  document.getElementById('container').appendChild(ov);
  ov.querySelector('.closeOverlay').addEventListener('click', ()=> ov.remove());
  setTimeout(()=> { if(document.body.contains(ov)) ov.remove(); }, 6000);
}

function launchConfetti(count=60){
  const colors = ['#ffd700','#ff6b6b','#7bd389','#7ec8ff','#ff9ff3','#c8f0ff'];
  for(let i=0;i<count;i++){
    const el = document.createElement('div');
    el.className = 'confetti-piece';
    const size = 6 + Math.random()*12;
    el.style.width = el.style.height = `${size}px`;
    el.style.left = `${Math.random()*100}vw`;
    el.style.top = `${-Math.random()*20 - 10}vh`;
    el.style.background = colors[Math.floor(Math.random()*colors.length)];
    el.style.borderRadius = `${Math.random()*50}%`;
    el.style.transform = `translateY(-100vh) rotate(${Math.random()*360}deg)`;
    el.style.animation = `fall ${3 + Math.random()*3}s linear forwards`;
    el.style.opacity = 0.95;
    el.style.zIndex = 120;
    document.body.appendChild(el);
    setTimeout(()=> el.remove(), 7000);
  }
}

function launchSad(count=24){
  const emoji = 'ðŸ˜¢';
  for(let i=0;i<count;i++){
    const el = document.createElement('div');
    el.className = 'sad-piece';
    const left = Math.random()*100;
    el.style.left = `${left}vw`;
    el.style.top = `${-Math.random()*10 - 10}vh`;
    el.style.fontSize = `${18 + Math.random()*26}px`;
    el.style.zIndex = 120;
    el.style.opacity = 0.95;
    el.style.animation = `fall-sad ${3 + Math.random()*3}s cubic-bezier(.2,.6,.4,1) forwards`;
    el.textContent = emoji;
    document.body.appendChild(el);
    setTimeout(()=> el.remove(), 7000);
  }
}

function showScreen(name){
  document.getElementById('usernameScreen').classList.remove('active'); document.getElementById('usernameScreen').setAttribute('aria-hidden','true');
  document.getElementById('quizScreen').classList.remove('active'); document.getElementById('quizScreen').setAttribute('aria-hidden','true');
  document.getElementById('resultScreen').classList.remove('active'); document.getElementById('resultScreen').setAttribute('aria-hidden','true');

  if(name==='username'){ document.getElementById('usernameScreen').classList.add('active'); document.getElementById('usernameScreen').setAttribute('aria-hidden','false'); }
  else if(name==='quiz'){ document.getElementById('quizScreen').classList.add('active'); document.getElementById('quizScreen').setAttribute('aria-hidden','false'); }
  else if(name==='result'){ document.getElementById('resultScreen').classList.add('active'); document.getElementB